
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Detect compliance and security violations across Infrastructure as Code to mitigate risk before deploying cloud native infrastructure.">
      
      
      
      
        <link rel="canonical" href="https://accurics.github.io/labs/labs/cli/azure/">
      
      <link rel="icon" href="../../../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.0">
    
    
      
        <title>Running the CLI - Accurics Labs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.33e2939f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../assets/css/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#running-accurics-cli" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Accurics Labs" class="md-header__button md-logo" aria-label="Accurics Labs" data-md-component="logo">
      
  <img src="../../../assets/images/logo_small.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Accurics Labs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Running the CLI
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/accurics/labs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    accurics/labs
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Accurics Labs" class="md-nav__button md-logo" aria-label="Accurics Labs" data-md-component="logo">
      
  <img src="../../../assets/images/logo_small.png" alt="logo">

    </a>
    Accurics Labs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/accurics/labs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    accurics/labs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Labs
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Labs" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Labs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" checked>
      
      <label class="md-nav__link" for="__nav_2_1">
        Accurics CLI
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Accurics CLI" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Accurics CLI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../installing/" class="md-nav__link">
        Installing the CLI
      </a>
    </li>
  

          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_2" type="checkbox" id="__nav_2_1_2" checked>
      
      <label class="md-nav__link" for="__nav_2_1_2">
        Azure
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Azure" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_1_2">
          <span class="md-nav__icon md-icon"></span>
          Azure
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Running the CLI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Running the CLI
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-log-in-to-azure" class="md-nav__link">
    Step 1: Log in to Azure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-download-configuration-file" class="md-nav__link">
    Step 2: Download configuration file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-sample-terraform-code" class="md-nav__link">
    Step 3: Sample Terraform Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-accurics-init" class="md-nav__link">
    Step 4: accurics init
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-accurics-plan" class="md-nav__link">
    Step 5: accurics plan
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-viewing-results" class="md-nav__link">
    Step 6: Viewing results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-fixing-bad-iac-and-rescanning" class="md-nav__link">
    Step 7: Fixing bad IaC and rescanning
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      <label class="md-nav__link" for="__nav_2_2">
        Accurics Console
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Accurics Console" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Accurics Console
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2_1" type="checkbox" id="__nav_2_2_1" >
      
      <label class="md-nav__link" for="__nav_2_2_1">
        SCM Scanning
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="SCM Scanning" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_2_1">
          <span class="md-nav__icon md-icon"></span>
          SCM Scanning
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../console/scm/ado/" class="md-nav__link">
        Azure DevOps
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      <label class="md-nav__link" for="__nav_2_3">
        Accurics in IDE
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Accurics in IDE" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Accurics in IDE
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ide/vscode/" class="md-nav__link">
        Microsoft VS Code
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-log-in-to-azure" class="md-nav__link">
    Step 1: Log in to Azure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-download-configuration-file" class="md-nav__link">
    Step 2: Download configuration file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-sample-terraform-code" class="md-nav__link">
    Step 3: Sample Terraform Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-accurics-init" class="md-nav__link">
    Step 4: accurics init
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-accurics-plan" class="md-nav__link">
    Step 5: accurics plan
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-viewing-results" class="md-nav__link">
    Step 6: Viewing results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-fixing-bad-iac-and-rescanning" class="md-nav__link">
    Step 7: Fixing bad IaC and rescanning
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/accurics/labs/edit/main/docs/labs/cli/azure/index.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="running-accurics-cli">Running Accurics CLI</h1>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Terraform version &gt;= .12</li>
<li>An Accurics user account with an Operator or greater role</li>
<li>An Azure subscription with enough permissions to create a resource and network security group</li>
<li>Setup an environment on the Accurics Console to scan your IAC repository that you will be using to create the CI/CD builds</li>
<li>Install the <a href="../installing/">Accurics CLI</a> suitable for your operating system</li>
</ul>
<h2 id="step-1-log-in-to-azure">Step 1: Log in to Azure</h2>
<p>For Terraform to be able to successfully <code>plan</code>, you must first authenticate to Azure. There are multiple ways to do this, depending on your organizations preference. Please see the HashiCorp documentation links below for more information:</p>
<p><a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/guides/azure_cli">Azure Provider: Authenticating using the Azure CLI</a></p>
<p><a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/guides/managed_service_identity">Azure Provider: Authenticating using managed identities for Azure resources</a></p>
<p><a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/guides/service_principal_client_certificate">Azure Provider: Authenticating using a Service Principal with a Client Certificate</a></p>
<p><a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/guides/service_principal_client_secret">Azure Provider: Authenticating using a Service Principal with a Client Secret</a></p>
<h2 id="step-2-download-configuration-file">Step 2: Download configuration file</h2>
<p>Depending on your organization, you may already have a copy of your Accurics configuration file. If one hasn't been supplied to you, it can be downloaded from the Accurics Console.</p>
<ol>
<li>Log into the Accurics console</li>
<li>Click the three vertical dots to open the menu for your environment</li>
<li>
<p>Click <strong>Download Config</strong></p>
<p><img alt="Download CLI" src="../../../assets/images/cli_download_config.png" /></p>
</li>
<li>
<p>Save the file to your computer to a folder of your choosing.</p>
</li>
</ol>
<h2 id="step-3-sample-terraform-code">Step 3: Sample Terraform Code</h2>
<p>Please copy the Terraform code below and save it as <code>azure_example.tf</code> to the same folder as the configuration file.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>The Terraform code below is an example of what could be considered a bad practice (opening SSH to the world) and should not be used in your environment.</p>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">provider</span> <span class="s">&quot;azurerm&quot;</span> <span class=" -Punctuation">{</span>
  <span class="err">features</span> <span class=" -Punctuation">{}</span>
<span class=" -Punctuation">}</span>

<span class="kr">variable</span> <span class="s">&quot;resource_group&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">  default</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span>
<span class=" -Punctuation">}</span>

<span class="kr">variable</span> <span class="s">&quot;location&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">  default</span> <span class="o">=</span> <span class="s2">&quot;centralus&quot;</span>
<span class=" -Punctuation">}</span>

<span class="kr">resource</span> <span class="s">&quot;azurerm_resource_group&quot; &quot;rg&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">  name</span>     <span class="o">=</span> <span class="err">var</span><span class="p">.</span><span class="err">resource_group</span>
<span class="na">  location</span> <span class="o">=</span> <span class="err">var</span><span class="p">.</span><span class="err">location</span>
<span class=" -Punctuation">}</span>

<span class="kr">resource</span> <span class="s">&quot;azurerm_network_security_group&quot; &quot;azure_nsg&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">  name</span>                <span class="o">=</span> <span class="s2">&quot;accurics_demo&quot;</span>
<span class="na">  location</span>            <span class="o">=</span> <span class="err">azurerm_resource_group</span><span class="p">.</span><span class="err">rg</span><span class="p">.</span><span class="err">location</span>
<span class="na">  resource_group_name</span> <span class="o">=</span> <span class="err">azurerm_resource_group</span><span class="p">.</span><span class="err">rg</span><span class="p">.</span><span class="err">name</span>
<span class=" -Punctuation">}</span>

<span class="kr">resource</span> <span class="s">&quot;azurerm_network_security_rule&quot; &quot;ssh&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">  name</span>                        <span class="o">=</span> <span class="s2">&quot;accurics_demo_ssh&quot;</span>
<span class="na">  priority</span>                    <span class="o">=</span> <span class="m">100</span>
<span class="na">  direction</span>                   <span class="o">=</span> <span class="s2">&quot;Inbound&quot;</span>
<span class="na">  access</span>                      <span class="o">=</span> <span class="s2">&quot;Allow&quot;</span>
<span class="na">  protocol</span>                    <span class="o">=</span> <span class="s2">&quot;Tcp&quot;</span>
<span class="na">  source_port_range</span>           <span class="o">=</span> <span class="s2">&quot;22&quot;</span>
<span class="na">  destination_port_range</span>      <span class="o">=</span> <span class="s2">&quot;22&quot;</span>
<span class="na">  source_address_prefix</span>       <span class="o">=</span> <span class="s2">&quot;0.0.0.0/0&quot;</span>
<span class="na">  resource_group_name</span>         <span class="o">=</span> <span class="err">azurerm_resource_group</span><span class="p">.</span><span class="err">rg</span><span class="p">.</span><span class="err">name</span>
<span class="na">  network_security_group_name</span> <span class="o">=</span> <span class="err">azurerm_network_security_group</span><span class="p">.</span><span class="err">azure_nsg</span><span class="p">.</span><span class="err">name</span>
<span class=" -Punctuation">}</span>
</code></pre></div>
</td></tr></table>
<h2 id="step-4-accurics-init">Step 4: <code>accurics init</code></h2>
<p><code>accurics init</code> is a wrapper around <code>terraform init</code> that downloads all the required Terraform providers, and is required prior to running any further commands.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>&gt; accurics init

Initializing the backend...

Initializing provider plugins...
- Reusing previous version of hashicorp/azurerm from the dependency lock file
- Installing hashicorp/azurerm v2.50.0...
- Installed hashicorp/azurerm v2.50.0 (signed by HashiCorp)

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.
</code></pre></div>
</td></tr></table>
<h2 id="step-5-accurics-plan">Step 5: <code>accurics plan</code></h2>
<p>We're at the point where it's time to scan the sample Terraform you saved above! Let's run <code>accurics plan</code> which is a wrapper around <code>terraform plan</code> that:</p>
<ol>
<li>Runs a <code>terraform plan</code></li>
<li>Runs an analysis that compares the Terraform code to the resources that Terraform will create</li>
<li>Generates a dependency graph</li>
<li>Outputs JSON (<code>accurics_report.json</code>) and HTML (<code>accurics_report.html</code>) files listing any violations</li>
<li>Gives you a summary of how many resources are in the Terraform code, and number of violations sorted by severity</li>
<li>Uploads the results to the Accurics Console so they can be viewed online</li>
</ol>
<p>To run the plan, open a Terminal/Command Prompt to the directory where the Terraform and configuration file is saved and run the following command:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may have saved the configuration file to another location, please adjust the path accordingly. By default the Accurics CLI looks in <code>~/.accurics/config</code> and the CWD that <code>accurics plan</code> is executed from.</p>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>&gt; accurics plan -config=config
2021/03/10 15:49:51 runPlan...
2021/03/10 15:49:51 [plan -out=1615412991082.out]
2021/03/10 15:50:03 Running Accurics analysis...
[snipped]/iac/azure
2021/03/10 15:50:03 mapping terraform resources to source code...
2021/03/10 15:50:03 Repo Root Path... [snipped]/iac/azure
2021/03/10 15:50:03 Current working directory ... [snipped]/iac/azure
2021/03/10 15:50:03 getting source code for all the resources present in &#39;[snipped]/iac/azure&#39;
2021/03/10 15:50:03 resources to source code mapping done!
2021/03/10 15:50:03 Creating dependency graph...
2021/03/10 15:50:03 GetDotFileUsingGraph Directory: [snipped]/iac/azure
2021/03/10 15:50:03 Using configuration file:-  [snipped]/config
----------------------------------------------------------------------------------------------------------------

Accurics successfully scanned the repository! Following is the summary - for details visit Accurics Web Console.

{
  &quot;resources&quot;: 3,
  &quot;violation&quot;: 2,
  &quot;low&quot;: 1,
  &quot;medium&quot;: 0,
  &quot;high&quot;: 1,
  &quot;native&quot;: 2,
  &quot;inherit&quot;: 0,
  &quot;drift&quot;: 0,
  &quot;iacdrift&quot;: 0,
  &quot;clouddrift&quot;: 0
}

----------------------------------------------------------------------------------------------------------------
</code></pre></div>
</td></tr></table>
<h2 id="step-6-viewing-results">Step 6: Viewing results</h2>
<p>The Accurics CLI outputs results in a few ways.</p>
<ol>
<li>To <code>stdout</code> as a summary of the <em>quantity</em> and <em>severity</em> of what was found.</li>
<li>A JSON blob in the directory you ran the Accurics CLI from</li>
<li>An HTML file that is also in the directory you ran the Accurics CLI from</li>
</ol>
<p>The HTML is probably the most human readable format, so let's open that and see what it says!</p>
<p>Do you see the violation for <code>SSH (TCP:22) is exposed to the entire public internet</code>? Let's try fixing that and rerunning <code>accurics plan</code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this lab, there will always be an policy violation for Azure Resource Groups. This is because the code needs to be deployed to the cloud for Accurics to detect the lock.</p>
<ul>
<li>Resource Manager Locks allow administrators to lock down Azure resources and prevent deletion or changing of resources. You can set the lock level to CanNotDelete or ReadOnly. In the portal, the locks are called Delete and Read-only respectively. It is recommended to have locks enabled to prevent accidental or malicious change or deletion.</li>
<li>Ensure that Azure Resource Group has resource lock enabled</li>
</ul>
</div>
<h2 id="step-7-fixing-bad-iac-and-rescanning">Step 7: Fixing bad IaC and rescanning</h2>
<p>Please remediate your Terraform with the highlighted changes below:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kr">provider</span> <span class="s">&quot;azurerm&quot;</span> <span class=" -Punctuation">{</span>
  <span class="err">features</span> <span class=" -Punctuation">{}</span>
<span class=" -Punctuation">}</span>

<span class="kr">variable</span> <span class="s">&quot;resource_group&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">  default</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span>
<span class=" -Punctuation">}</span>

<span class="kr">variable</span> <span class="s">&quot;location&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">  default</span> <span class="o">=</span> <span class="s2">&quot;centralus&quot;</span>
<span class=" -Punctuation">}</span>

<span class="kr">resource</span> <span class="s">&quot;azurerm_resource_group&quot; &quot;rg&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">  name</span>     <span class="o">=</span> <span class="err">var</span><span class="p">.</span><span class="err">resource_group</span>
<span class="na">  location</span> <span class="o">=</span> <span class="err">var</span><span class="p">.</span><span class="err">location</span>
<span class=" -Punctuation">}</span>

<span class="kr">resource</span> <span class="s">&quot;azurerm_network_security_group&quot; &quot;azure_nsg&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">  name</span>                <span class="o">=</span> <span class="s2">&quot;accurics_demo&quot;</span>
<span class="na">  location</span>            <span class="o">=</span> <span class="err">azurerm_resource_group</span><span class="p">.</span><span class="err">rg</span><span class="p">.</span><span class="err">location</span>
<span class="na">  resource_group_name</span> <span class="o">=</span> <span class="err">azurerm_resource_group</span><span class="p">.</span><span class="err">rg</span><span class="p">.</span><span class="err">name</span>
<span class=" -Punctuation">}</span>

<span class="kr">resource</span> <span class="s">&quot;azurerm_network_security_rule&quot; &quot;ssh&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">  name</span>                        <span class="o">=</span> <span class="s2">&quot;accurics_demo_ssh&quot;</span>
<span class="na">  priority</span>                    <span class="o">=</span> <span class="m">100</span>
<span class="na">  direction</span>                   <span class="o">=</span> <span class="s2">&quot;Inbound&quot;</span>
<span class="na">  access</span>                      <span class="o">=</span> <span class="s2">&quot;Allow&quot;</span>
<span class="na">  protocol</span>                    <span class="o">=</span> <span class="s2">&quot;Tcp&quot;</span>
<span class="na">  source_port_range</span>           <span class="o">=</span> <span class="s2">&quot;22&quot;</span>
<span class="na">  destination_port_range</span>      <span class="o">=</span> <span class="s2">&quot;22&quot;</span>
<span class="hll"><span class="na">  source_address_prefix</span>       <span class="o">=</span> <span class="s2">&quot;10.10.10.0/24&quot;</span>
</span><span class="na">  resource_group_name</span>         <span class="o">=</span> <span class="err">azurerm_resource_group</span><span class="p">.</span><span class="err">rg</span><span class="p">.</span><span class="err">name</span>
<span class="na">  network_security_group_name</span> <span class="o">=</span> <span class="err">azurerm_network_security_group</span><span class="p">.</span><span class="err">azure_nsg</span><span class="p">.</span><span class="err">name</span>
<span class=" -Punctuation">}</span>
</code></pre></div>
</td></tr></table>
<p>Let's rerun <code>accurics plan</code> and see how many violations it's found after fixing the two violations:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;resources&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
  <span class="nt">&quot;violation&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;low&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;medium&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;high&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;native&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;inherit&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;drift&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;iacdrift&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;clouddrift&quot;</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../installing/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Installing the CLI
            </div>
          </div>
        </a>
      
      
        <a href="../../console/scm/ado/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Azure DevOps
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2021 Accurics, Inc. All rights reserved.
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://twitter.com/AccuricsSec" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.linkedin.com/company/accurics" target="_blank" rel="noopener" title="www.linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://github.com/accurics" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.d892486b.min.js"></script>
      
    
  </body>
</html>